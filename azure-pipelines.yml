trigger:
  branches:
    include:
    - main
pr:
  branches:
    include:
    - main

pool:
  vmImage: 'ubuntu-latest'

jobs:
- job: check_commits
  displayName: Check PR Commits
  condition: eq(variables['Build.Reason'], 'PullRequest')
  steps:
    - checkout: self
      fetchDepth: 0
    - task: Bash@3
      displayName: Check PR Commit Count
      inputs:
        targetType: inline
        script: |
          git fetch origin
          SOURCE_BRANCH_NAME=$(echo $(System.PullRequest.SourceBranch))
          TARGET_BRANCH_NAME=$(echo $(System.PullRequest.TargetBranch) | sed 's/refs\/heads\///')
          echo "Source branch: $SOURCE_BRANCH_NAME"
          echo "Target branch: $TARGET_BRANCH_NAME"
          commit_count=$(git rev-list --count origin/$SOURCE_BRANCH_NAME..origin/$TARGET_BRANCH_NAME)
          echo "Commit count: $commit_count"
